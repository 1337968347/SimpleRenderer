let t=!1;const s="undefined"!=typeof window?window:{},i=s.document||{head:{}},n={t:0,i:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,s,i,n)=>t.addEventListener(s,i,n),rel:(t,s,i,n)=>t.removeEventListener(s,i,n),ce:(t,s)=>new CustomEvent(t,s)},r=t=>Promise.resolve(t),e=(t,s)=>{s&&!t.h&&s["s-p"]&&s["s-p"].push(new Promise((s=>t.h=s)))},h=t=>{if(!(4&t.t))return e(t,t.o),C((()=>o(t)));t.t|=512},o=t=>{const s=t.u;return f(void 0,(()=>c(t,s)))},c=async(t,s)=>{const i=t.l,n=i["s-rc"];a(t,s),n&&(n.map((t=>t())),i["s-rc"]=void 0);{const s=i["s-p"],n=()=>u(t);0===s.length?n():(Promise.all(s).then(n),t.t|=4,s.length=0)}},a=(t,s)=>{try{s=s.render(),t.t|=2}catch(s){y(s,t.l)}return null},u=t=>{const s=t.l,i=t.o;64&t.t||(t.t|=64,d(s),t.v(s),i||l()),t.h&&(t.h(),t.h=void 0),512&t.t&&T((()=>h(t))),t.t&=-517},l=()=>{d(i.documentElement),T((()=>(t=>{const s=n.ce("appload",{detail:{namespace:"app"}});return t.dispatchEvent(s),s})(s)))},f=(t,s)=>t&&t.then?t.then(s):s(),d=t=>t.classList.add("hydrated"),v=(t,r={})=>{const o=[],c=r.exclude||[],a=s.customElements,u=i.head,f=u.querySelector("meta[charset]"),d=i.createElement("style"),v=[];let w,g=!0;Object.assign(n,r),n.i=new URL(r.resourcesUrl||"./",i.baseURI).href,t.map((t=>t[1].map((s=>{const i={t:s[0],p:s[1],m:s[2],g:s[3]},r=i.p,u=class extends HTMLElement{constructor(t){super(t),m(t=this,i)}connectedCallback(){w&&(clearTimeout(w),w=null),g?v.push(this):n.jmp((()=>(t=>{if(0==(1&n.t)){const s=p(t),i=s.M,n=()=>{};if(!(1&s.t)){s.t|=1;{let i=t;for(;i=i.parentNode||i.host;)if(i["s-p"]){e(s,s.o=i);break}}(async(t,s,i,n,r)=>{if(0==(32&s.t)){if(s.t|=32,(r=M(i)).then){const t=()=>{};r=await r,t()}const t=()=>{};try{new r(s)}catch(t){y(t)}t()}const e=s.o,o=()=>h(s);e&&e["s-rc"]?e["s-rc"].push(o):o()})(0,s,i)}n()}})(this)))}disconnectedCallback(){n.jmp((()=>{}))}componentOnReady(){return p(this).$}};i.T=t[0],c.includes(r)||a.get(r)||(o.push(r),a.define(r,u))})))),d.innerHTML=o+"{visibility:hidden}.hydrated{visibility:inherit}",d.setAttribute("data-styles",""),u.insertBefore(d,f?f.nextSibling:u.firstChild),g=!1,v.length?v.map((t=>t.connectedCallback())):n.jmp((()=>w=setTimeout(l,30)))},w=new WeakMap,p=t=>w.get(t),m=(t,s)=>{const i={t:0,l:t,M:s,C:new Map};return i.$=new Promise((t=>i.v=t)),t["s-p"]=[],t["s-rc"]=[],w.set(t,i)},y=(t,s)=>(0,console.error)(t,s),g=new Map,M=t=>{const s=t.p.replace(/-/g,"_"),i=t.T,n=g.get(i);return n?n[s]:import(`./${i}.entry.js`).then((t=>(g.set(i,t),t[s])),y)},x=[],$=[],E=(s,i)=>r=>{s.push(r),t||(t=!0,i&&4&n.t?T(A):n.raf(A))},b=t=>{for(let s=0;s<t.length;s++)try{t[s](performance.now())}catch(t){y(t)}t.length=0},A=()=>{b(x),b($),(t=x.length>0)&&n.raf(A)},T=t=>r().then(t),C=E($,!0);let S;const O=t=>{if(!S){if(t||(t=document.querySelector("canvas")),!t)return null;S=t.getContext("webgl")}return S};class P{constructor(t){this.unit=-1,this.image=t,this.gl=O(),this.texture=this.gl.createTexture();const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.generateMipmap(s.TEXTURE_2D)}bindTexture(t){void 0!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.unit=t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}uniform(t){this.gl.uniform1i(t,this.unit)}}class L{constructor(t){this.gl=O(),this.length=t.length,this.buffer=this.gl.createBuffer(),this.bind(),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW)}bind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer)}drawTriangles(){this.gl.drawArrays(this.gl.TRIANGLES,0,this.length/3)}}const R=(t,s)=>(s=>({uniform:i=>{t(i,s)},value:s}))(s),j=O();class F{static Mat4(t){return R((s=>{j.uniformMatrix4fv(s,!1,t)}),t)}static Mat3(t){return R((s=>{j.uniformMatrix3fv(s,!1,t)}),t)}static Vec3(t){return R((s=>{j.uniform3fv(s,t)}),t)}static Vec4(t){return R((s=>{j.uniform4fv(s,t)}),t)}static Int(t){return R((s=>{j.uniform1i(s,t)}),t)}}const k=function(t){var s=new Float32Array(3);return t&&(s[0]=t[0],s[1]=t[1],s[2]=t[2]),s},I=function(t){var s=new Float32Array(9);return t&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8]),s},N={create:function(t){var s=new Float32Array(16);return t&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s},set:function(t,s){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,s){if(!s||t==s){var i=t[1],n=t[2],r=t[3],e=t[6],h=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=e,t[11]=t[14],t[12]=r,t[13]=h,t[14]=o,t}return s[0]=t[0],s[1]=t[4],s[2]=t[8],s[3]=t[12],s[4]=t[1],s[5]=t[5],s[6]=t[9],s[7]=t[13],s[8]=t[2],s[9]=t[6],s[10]=t[10],s[11]=t[14],s[12]=t[3],s[13]=t[7],s[14]=t[11],s[15]=t[15],s},determinant:function(t){var s=t[0],i=t[1],n=t[2],r=t[3],e=t[4],h=t[5],o=t[6],c=t[7],a=t[8],u=t[9],l=t[10],f=t[11],d=t[12],v=t[13],w=t[14],p=t[15];return d*u*o*r-a*v*o*r-d*h*l*r+e*v*l*r+a*h*w*r-e*u*w*r-d*u*n*c+a*v*n*c+d*i*l*c-s*v*l*c-a*i*w*c+s*u*w*c+d*h*n*f-e*v*n*f-d*i*o*f+s*v*o*f+e*i*w*f-s*h*w*f-a*h*n*p+e*u*n*p+a*i*o*p-s*u*o*p-e*i*l*p+s*h*l*p},inverse:function(t,s){s||(s=t);var i=t[0],n=t[1],r=t[2],e=t[3],h=t[4],o=t[5],c=t[6],a=t[7],u=t[8],l=t[9],f=t[10],d=t[11],v=t[12],w=t[13],p=t[14],m=t[15],y=i*o-n*h,g=i*c-r*h,M=i*a-e*h,x=n*c-r*o,$=n*a-e*o,E=r*a-e*c,b=u*w-l*v,A=u*p-f*v,T=u*m-d*v,C=l*p-f*w,S=l*m-d*w,O=f*m-d*p,P=1/(y*O-g*S+M*C+x*T-$*A+E*b);return s[0]=(o*O-c*S+a*C)*P,s[1]=(-n*O+r*S-e*C)*P,s[2]=(w*E-p*$+m*x)*P,s[3]=(-l*E+f*$-d*x)*P,s[4]=(-h*O+c*T-a*A)*P,s[5]=(i*O-r*T+e*A)*P,s[6]=(-v*E+p*M-m*g)*P,s[7]=(u*E-f*M+d*g)*P,s[8]=(h*S-o*T+a*b)*P,s[9]=(-i*S+n*T-e*b)*P,s[10]=(v*$-w*M+m*y)*P,s[11]=(-u*$+l*M-d*y)*P,s[12]=(-h*C+o*A-c*b)*P,s[13]=(i*C-n*A+r*b)*P,s[14]=(-v*x+w*g-p*y)*P,s[15]=(u*x-l*g+f*y)*P,s},toRotationMat:function(t,s){return s||(s=N.create()),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},toMat3:function(t,s){return s||(s=I()),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[4],s[4]=t[5],s[5]=t[6],s[6]=t[8],s[7]=t[9],s[8]=t[10],s},toInverseMat3:function(t,s){var i=t[0],n=t[1],r=t[2],e=t[4],h=t[5],o=t[6],c=t[8],a=t[9],u=t[10],l=u*h-o*a,f=-u*e+o*c,d=a*e-h*c,v=i*l+n*f+r*d;if(!v)return null;var w=1/v;return s||(s=I()),s[0]=l*w,s[1]=(-u*n+r*a)*w,s[2]=(o*n-r*h)*w,s[3]=f*w,s[4]=(u*i-r*c)*w,s[5]=(-o*i+r*e)*w,s[6]=d*w,s[7]=(-a*i+n*c)*w,s[8]=(h*i-n*e)*w,s},multiply:function(t,s,i){i||(i=t);var n=t[0],r=t[1],e=t[2],h=t[3],o=t[4],c=t[5],a=t[6],u=t[7],l=t[8],f=t[9],d=t[10],v=t[11],w=t[12],p=t[13],m=t[14],y=t[15],g=s[0],M=s[1],x=s[2],$=s[3],E=s[4],b=s[5],A=s[6],T=s[7],C=s[8],S=s[9],O=s[10],P=s[11],L=s[12],R=s[13],j=s[14],F=s[15];return i[0]=g*n+M*o+x*l+$*w,i[1]=g*r+M*c+x*f+$*p,i[2]=g*e+M*a+x*d+$*m,i[3]=g*h+M*u+x*v+$*y,i[4]=E*n+b*o+A*l+T*w,i[5]=E*r+b*c+A*f+T*p,i[6]=E*e+b*a+A*d+T*m,i[7]=E*h+b*u+A*v+T*y,i[8]=C*n+S*o+O*l+P*w,i[9]=C*r+S*c+O*f+P*p,i[10]=C*e+S*a+O*d+P*m,i[11]=C*h+S*u+O*v+P*y,i[12]=L*n+R*o+j*l+F*w,i[13]=L*r+R*c+j*f+F*p,i[14]=L*e+R*a+j*d+F*m,i[15]=L*h+R*u+j*v+F*y,i},multiplyVec3:function(t,s,i){i||(i=s);var n=s[0],r=s[1],e=s[2];return i[0]=t[0]*n+t[4]*r+t[8]*e+t[12],i[1]=t[1]*n+t[5]*r+t[9]*e+t[13],i[2]=t[2]*n+t[6]*r+t[10]*e+t[14],i},multiplyVec4:function(t,s,i){i||(i=s);var n=s[0],r=s[1],e=s[2],h=s[3];return i[0]=t[0]*n+t[4]*r+t[8]*e+t[12]*h,i[1]=t[1]*n+t[5]*r+t[9]*e+t[13]*h,i[2]=t[2]*n+t[6]*r+t[10]*e+t[14]*h,i[3]=t[3]*n+t[7]*r+t[11]*e+t[15]*h,i},translate:function(t,s,i){var n=s[0],r=s[1],e=s[2];if(!i||t==i)return t[12]=t[0]*n+t[4]*r+t[8]*e+t[12],t[13]=t[1]*n+t[5]*r+t[9]*e+t[13],t[14]=t[2]*n+t[6]*r+t[10]*e+t[14],t[15]=t[3]*n+t[7]*r+t[11]*e+t[15],t;var h=t[0],o=t[1],c=t[2],a=t[3],u=t[4],l=t[5],f=t[6],d=t[7],v=t[8],w=t[9],p=t[10],m=t[11];return i[0]=h,i[1]=o,i[2]=c,i[3]=a,i[4]=u,i[5]=l,i[6]=f,i[7]=d,i[8]=v,i[9]=w,i[10]=p,i[11]=m,i[12]=h*n+u*r+v*e+t[12],i[13]=o*n+l*r+w*e+t[13],i[14]=c*n+f*r+p*e+t[14],i[15]=a*n+d*r+m*e+t[15],i},scale:function(t,s,i){var n=s[0],r=s[1],e=s[2];return i&&t!=i?(i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=r,t[5]*=r,t[6]*=r,t[7]*=r,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},rotate:function(t,s,i,n){var r=i[0],e=i[1],h=i[2],o=Math.sqrt(r*r+e*e+h*h);if(!o)return null;1!=o&&(r*=o=1/o,e*=o,h*=o);var c=Math.sin(s),a=Math.cos(s),u=1-a,l=t[0],f=t[1],d=t[2],v=t[3],w=t[4],p=t[5],m=t[6],y=t[7],g=t[8],M=t[9],x=t[10],$=t[11],E=r*r*u+a,b=e*r*u+h*c,A=h*r*u-e*c,T=r*e*u-h*c,C=e*e*u+a,S=h*e*u+r*c,O=r*h*u+e*c,P=e*h*u-r*c,L=h*h*u+a;return n?t!=n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=l*E+w*b+g*A,n[1]=f*E+p*b+M*A,n[2]=d*E+m*b+x*A,n[3]=v*E+y*b+$*A,n[4]=l*T+w*C+g*S,n[5]=f*T+p*C+M*S,n[6]=d*T+m*C+x*S,n[7]=v*T+y*C+$*S,n[8]=l*O+w*P+g*L,n[9]=f*O+p*P+M*L,n[10]=d*O+m*P+x*L,n[11]=v*O+y*P+$*L,n},rotateX:function(t,s,i){var n=Math.sin(s),r=Math.cos(s),e=t[4],h=t[5],o=t[6],c=t[7],a=t[8],u=t[9],l=t[10],f=t[11];return i?t!=i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=e*r+a*n,i[5]=h*r+u*n,i[6]=o*r+l*n,i[7]=c*r+f*n,i[8]=e*-n+a*r,i[9]=h*-n+u*r,i[10]=o*-n+l*r,i[11]=c*-n+f*r,i},rotateY:function(t,s,i){var n=Math.sin(s),r=Math.cos(s),e=t[0],h=t[1],o=t[2],c=t[3],a=t[8],u=t[9],l=t[10],f=t[11];return i?t!=i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=e*r+a*-n,i[1]=h*r+u*-n,i[2]=o*r+l*-n,i[3]=c*r+f*-n,i[8]=e*n+a*r,i[9]=h*n+u*r,i[10]=o*n+l*r,i[11]=c*n+f*r,i},rotateZ:function(t,s,i){var n=Math.sin(s),r=Math.cos(s),e=t[0],h=t[1],o=t[2],c=t[3],a=t[4],u=t[5],l=t[6],f=t[7];return i?t!=i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=e*r+a*n,i[1]=h*r+u*n,i[2]=o*r+l*n,i[3]=c*r+f*n,i[4]=e*-n+a*r,i[5]=h*-n+u*r,i[6]=o*-n+l*r,i[7]=c*-n+f*r,i},frustum:function(t,s,i,n,r,e,h){h||(h=N.create());var o=s-t,c=n-i,a=e-r;return h[0]=2*r/o,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*r/c,h[6]=0,h[7]=0,h[8]=(s+t)/o,h[9]=(n+i)/c,h[10]=-(e+r)/a,h[11]=-1,h[12]=0,h[13]=0,h[14]=-e*r*2/a,h[15]=0,h},perspective:function(t,s,i,n,r){var e=i*Math.tan(t*Math.PI/360),h=e*s;return N.frustum(-h,h,-e,e,i,n,r)},ortho:function(t,s,i,n,r,e,h){h||(h=N.create());var o=s-t,c=n-i,a=e-r;return h[0]=2/o,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/c,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=-2/a,h[11]=0,h[12]=-(t+s)/o,h[13]=-(n+i)/c,h[14]=-(e+r)/a,h[15]=1,h},lookAt:function(t,s,i,n){n||(n=N.create());var r,e,h,o,c,a,u,l,f,d,v=t[0],w=t[1],p=t[2],m=i[0],y=i[1],g=i[2];return v==s[0]&&w==s[1]&&p==s[2]?N.identity(n):(h=p-s[2],(d=Math.sqrt((o=y*(h*=d=1/Math.sqrt((r=v-s[0])*r+(e=w-s[1])*e+h*h))-g*(e*=d))*o+(c=g*(r*=d)-m*h)*c+(a=m*e-y*r)*a))?(o*=d=1/d,c*=d,a*=d):(o=0,c=0,a=0),(d=Math.sqrt((u=e*a-h*c)*u+(l=h*o-r*a)*l+(f=r*c-e*o)*f))?(u*=d=1/d,l*=d,f*=d):(u=0,l=0,f=0),n[0]=o,n[1]=u,n[2]=r,n[3]=0,n[4]=c,n[5]=l,n[6]=e,n[7]=0,n[8]=a,n[9]=f,n[10]=h,n[11]=0,n[12]=-(o*v+c*w+a*p),n[13]=-(u*v+l*w+f*p),n[14]=-(r*v+e*w+h*p),n[15]=1,n)},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"}};class U{constructor(t=[]){this.children=[],this.children=t}visit(t){this.enter(t);for(let s=0;s<this.children.length;s++)this.children[s].visit(t);this.exit(t)}exit(t){}append(t){this.children.push(t)}enter(t){}}class _ extends U{constructor(t,s,i){super(),this.children=[],this.shader=t,this.uniforms=s,this.children=i}enter(t){t.pushShader(this.shader),this.shader.use(),W.prototype.enter.call(this,t)}exit(t){t.popShader(),W.prototype.exit.call(this,t)}}class D extends U{constructor(t){super(),this.children=[],this.pitch=0,this.yaw=0,this.near=.1,this.far=5e3,this.fov=50,this.children=t,this.gl=O(),this.position=k([0,1,2])}enter(t){t.pushUniforms(),t.uniforms.projection=F.Mat4(this.getProjection(t)),t.uniforms.worldView=F.Mat4(this.getWorldView())}exit(t){t.popUniforms()}project(t,s){const i=N.create();N.multiply(this.getProjection(s),this.getWorldView(),i);const n=N.multiplyVec4(i,t,function(t,s){var i=new Float32Array(4);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t.length>3?t[3]:s),i}());return function(t,s,i){i&&t!=i?(i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s):(t[0]*=s,t[1]*=s,t[2]*=s,t[3]*=s)}(n,1/n[3]),n}getInverseRotation(){return function(t,s){return s||(s=N.create()),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=0,s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=0,s[8]=t[6],s[9]=t[7],s[10]=t[8],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}(N.toInverseMat3(this.getWorldView()))}getProjection(t){return N.perspective(this.fov,t.viewportWidth/t.viewportHeight,this.near,this.far)}getWorldView(){const t=N.identity(N.create());return N.rotateX(t,this.pitch),N.rotateY(t,this.yaw),N.translate(t,function(t,s){return s||(s=t),s[0]=-t[0],s[1]=-t[1],s[2]=-t[2],s}(this.position,k())),t}}class V{constructor(){this.root=new U,this.uniforms={},this.shaders=[],this.viewportWidth=640,this.viewportHeight=480,this.textureUnit=0,this.gl=O(),this.root=new U}draw(){this.gl.viewport(0,0,this.viewportWidth,this.viewportHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.root.visit(this)}pushUniforms(){this.uniforms=Object.create(this.uniforms)}popUniforms(){this.uniforms=Object.getPrototypeOf(this.uniforms)}pushTextura(){return this.textureUnit++}popTextura(){this.textureUnit--}pushShader(t){this.shaders.push(t)}popShader(){this.shaders.pop()}getShader(){return this.shaders[this.shaders.length-1]}}class H extends U{constructor(t){super(),this.vbo=t,this.gl=O()}visit(t){const s=t.getShader(),i=s.getAttribLocation("position");this.gl.vertexAttribPointer(i,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(i),this.vbo.bind(),s.uniforms(t.uniforms),this.vbo.drawTriangles()}}class K extends U{constructor(t){super(),this.children=[],this.wordMatrix=N.create(),this.children=t}enter(t){t.pushUniforms(),t.uniforms.modelTransform=F.Mat4(this.wordMatrix)}exit(t){t.popUniforms()}}class W extends U{constructor(t,s){super(),this.uniforms=t,this.children=s}enter(t){t.pushUniforms();for(let s in this.uniforms){const i=this.uniforms[s];i instanceof P&&i.bindTexture(t.pushTextura()),t.uniforms[s]=i}}exit(t){for(let s in this.uniforms)this.uniforms[s]instanceof P&&t.popTextura()}}const G=(t,s,i)=>{const n=t.createShader(s);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n),s,i),'Compiler exception: "'+t.getShaderInfoLog(n)+'"';return n};class B{constructor(t,s){this.gl=O(),this.program=((t,s,i)=>{const n=G(t,t.VERTEX_SHADER,s),r=G(t,t.FRAGMENT_SHADER,i),e=t.createProgram();if(t.attachShader(e,n),t.attachShader(e,r),t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS))throw"Linker exception: "+t.getProgramInfoLog(e);return e})(this.gl,t,s)}use(){this.gl.useProgram(this.program)}uniforms(t){for(let s in t){const i=t[s],n=this.gl.getUniformLocation(this.program,s);if("number"==typeof i)return void this.gl.uniform1f(n,i);i.uniform(n)}}getAttribLocation(t){const s=this.gl.getAttribLocation(this.program,t);if(s<0)throw"attribute not found";return s}}class q{constructor(t){this.shaders={},this.prefix="shaders/",this.gl=O(),this.resources=t}get(t,s){s||(s=t+".frag",t+=".vertex");const i=`${t}-${s}`;return i in this.resources||(this.shaders[i]=new B(this.getSource(t),this.getSource(s))),this.shaders[i]}getSource(t){const s=this._getSourceName(t);return this.resources[this.prefix+s]||""}_getSourceName(t){const s=t.split("/");return s[s.length-1]}}class z{constructor(t){this.resources={},this.pendingStatus={total:0,pending:0,failed:0},this.loadImage=t=>{const s=document.createElement("img");s.src=this.rootPath+t,s.onload=()=>{this.success(t,s)},s.onerror=()=>{this.error(t,s)}},this.loadJSON=t=>{fetch(this.rootPath+t).then((async t=>t.json())).then((s=>this.success(t,s))).catch((s=>{this.error(t,s)}))},this.loadData=t=>{fetch(this.rootPath+t).then((async t=>t.text())).then((s=>{this.success(t,s)})).catch((s=>{this.error(t,s)}))},this.success=(t,s)=>{this.resources[t]=s,this.pendingStatus.pending--,0===this.pendingStatus.pending&&this.onRendy&&this.onRendy()},this.error=(t,s)=>{throw this.pendingStatus.pending--,this.pendingStatus.failed++,this.resources[t]=null,"string"!=typeof s&&(s.src=t),s},this.rootPath=t}load(t){for(let s=0;s<t.length;s++){const i=t[s];if(!(i in t)){if(this.pendingStatus.pending++,this.pendingStatus.total++,/\.(jpe?g|gif|png)$/.test(i))return void this.loadImage(i);if(/\.json$/.test(i))return void this.loadJSON(i);this.loadData(i)}}setTimeout((()=>{0===this.pendingStatus.pending&&this.onRendy&&this.onRendy()}),1)}setOnRendy(t){this.onRendy=t}}class X{constructor(t,s){this.input=t,this.camera=s}tick(){const{x:t,y:s}=this.input.getOffsetFromElementCenter();this.camera.yaw+=5e-5*t,this.camera.pitch+=5e-5*s;const i=this.camera.getInverseRotation(),n=k();this.input.keys.W?n[2]=-1:this.input.keys.S&&(n[2]=1),this.input.keys.A?n[0]=-1:this.input.keys.D&&(n[0]=1),function(t,s,i){i&&t!=i?(i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s):(t[0]*=s,t[1]*=s,t[2]*=s)}(function(t,s){s||(s=t);var i=t[0],n=t[1],r=t[2],e=Math.sqrt(i*i+n*n+r*r);return e?1==e?(s[0]=i,s[1]=n,s[2]=r,s):(s[0]=i*(e=1/e),s[1]=n*e,s[2]=r*e,s):(s[0]=0,s[1]=0,s[2]=0,s)}(n),.05),N.multiplyVec3(i,n),function(t,s,i){i&&t!=i?(i[0]=t[0]+s[0],i[1]=t[1]+s[1],i[2]=t[2]+s[2]):(t[0]+=s[0],t[1]+=s[1],t[2]+=s[2])}(this.camera.position,n)}}const Y={32:"SPACE",13:"ENTER",9:"TAB",8:"BACKSPACE",16:"SHIFT",17:"CTRL",18:"ALT",20:"CAPS_LOCK",144:"NUM_LOCK",145:"SCROLL_LOCK",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",33:"PAGE_UP",34:"PAGE_DOWN",36:"HOME",35:"END",45:"INSERT",46:"DELETE",27:"ESCAPE",19:"PAUSE"},Z=(t,s,i)=>t<s?s:t>i?i:t;class J{constructor(t){this.keys={},this.offset={x:0,y:0},this.mouse={down:!1,x:0,y:0},this.onClick=void 0,this.onKeyUp=void 0,this.onKeyDown=void 0,this.width=0,this.height=0,this.hasFocus=!0,this.element=void 0,this.focus=()=>{this.hasFocus||(this.hasFocus=!0,this.reset())},this.blur=()=>{this.hasFocus=!1,this.reset()},this.mouseMove=(t,s)=>{this.mouse.down&&(this.mouse.x=Z(t-this.offset.x,0,this.element.width),this.mouse.y=Z(s-this.offset.y,0,this.element.height))},this.mouseDown=(t,s)=>{this.mouse.down=!0,this.mouse.x=Z(t-this.offset.x,0,this.element.width),this.mouse.y=Z(s-this.offset.y,0,this.element.height)},this.mouseUp=()=>{this.mouse.down=!1,this.hasFocus&&this.onClick&&this.onClick(this.mouse.x,this.mouse.y)},this.keyDown=t=>{const s=this.getKeyName(t),i=this.keys[s];return this.keys[s]=!0,this.onKeyDown&&!i&&this.onKeyDown(s),this.hasFocus},this.keyUp=t=>{var s=this.getKeyName(t);return this.keys[s]=!1,this.onKeyUp&&this.onKeyUp(s),this.hasFocus},this.reset=()=>{this.keys={};for(let t=65;t<128;t++)this.keys[String.fromCharCode(t)]=!1;for(let t in Y)this.keys[Y[t]]=!1;this.mouse={down:!1,x:0,y:0}},this.getKeyName=t=>Y[t]||String.fromCharCode(t),this.element=t,this.bind(t),this.reset()}bind(t){if(!t)return;this.element=t;const s=t.getBoundingClientRect();this.offset={x:s.left,y:s.top},document.onkeydown=t=>this.keyDown(t.keyCode),document.onkeyup=t=>this.keyUp(t.keyCode),window.onclick=s=>{s.target===t?focus():blur()},this.element.onmousedown=t=>this.mouseDown(t.pageX,t.pageY),document.onmousemove=t=>this.mouseMove(t.pageX,t.pageY),document.onmouseup=this.mouseUp}getOffsetFromElementCenter(){return this.element&&this.mouse.down?{x:this.mouse.x-.5*this.element.width,y:this.mouse.y-.5*this.element.height}:{x:0,y:0}}}const Q=async()=>{const t=document.querySelector("canvas"),s=new J(t),i=(()=>{let t,s,i=!1,n=null;return{start:()=>{i=!0,t=(new Date).getTime();const r=window.requestAnimationFrame||(t=>{n=setInterval(t,16)}),e=()=>{i&&((()=>{const i=t;t=(new Date).getTime(),s&&s((t-i)/1e3)})(),r(e))};r(e)},stop:()=>{i=!1,n&&(clearInterval(n),n=null)},setOnTick:t=>{s=t}}})(),n=new z("./assets/");n.load(["shaders/transform.vert","shaders/color.frag"]),n.setOnRendy((()=>{const r=new q(n.resources).get("transform.vert","color.frag"),e=new V,h=new L((t=>{const s=new Float32Array(4050);let i=0;for(var n=0;n<t;n++)for(var r=0;r<t;r++)s[i++]=r/t,s[i++]=Math.random(),s[i++]=n/t,s[i++]=r/t,s[i++]=0,s[i++]=(n+1)/t,s[i++]=(r+1)/t,s[i++]=0,s[i++]=(n+1)/t,s[i++]=r/t,s[i++]=0,s[i++]=n/t,s[i++]=(r+1)/t,s[i++]=0,s[i++]=(n+1)/t,s[i++]=(r+1)/t,s[i++]=0,s[i++]=n/t;return s})(15)),o=new D([new W({color:F.Vec3([0,1,0])},[new _(r,{},[new K([new H(h)])])])]),c=new X(s,o);e.root.append(o),((t,s)=>{const i=()=>{t.width=s.viewportWidth=window.innerWidth,t.height=s.viewportHeight=window.innerHeight,s.draw()};window.addEventListener("resize",i,!1),i()})(t,e),i.setOnTick((()=>{c.tick(),e.draw()})),i.start()}))};export{v as b,Q as g,r as p}